<%-
  num_nodes = bc_num_slots.blank? ? 1 : bc_num_slots.to_i
  num_cpus_per_node = (node_type == 'hugemem') ? 48 : 28
  num_cpus_for_free = 4
  num_cpus_per_node_requested = [num_cores.to_i, num_cpus_per_node].min
  num_cpus_available = (num_nodes * num_cpus_per_node_requested) - num_cpus_for_free
  ansys_par_request = (reserve_parallel_licenses.to_i == 1) ? "\%ansyspar+#{num_cpus_available}" : ""
  software_request = "ansys+1" + ansys_par_request
-%>
---
batch_connect:
  template: "vnc"
script:
  native:
    resources:
      nodes: "<%= num_nodes %>:ppn=<%= num_cpus_per_node_requested %><%= node_type %>"
      software: "<%= software_request %>"
